<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Obƒçianske zdru≈æenie Podbansk√©</title>
<style>
:root {
  --primary-brown: #3A2F2A;
  --accent-gold: #B8860B;
  --neutral-cream: #F8F6F0;
  --neutral-off-white: #FDFDFC;
  --text-primary: #1A1A1A;
  --text-secondary: #6B6B6B;
  --radius-lg: 0.5rem;
  --space-4: 1rem;
  --space-6: 1.5rem;
  --font-body: 'Inter', sans-serif;
  --font-display: 'Playfair Display', serif;
}
body {
  font-family: var(--font-body);
  background: var(--neutral-cream);
  margin: 0;
  padding: var(--space-6);
  color: var(--text-primary);
}

.admin-section-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-6);
  align-items: start;
}

.preview-panel {
  background: var(--neutral-off-white);
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(0,0,0,0.1);
}

.hero-preview {
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 2rem;
  border-radius: var(--radius-lg);
  min-height: 300px;
  position: relative;
}

.preview-content {
  max-width: 600px;
}

.preview-eyebrow {
  color: var(--accent-gold);
  font-weight: 600;
  margin-bottom: 0.5em;
}

.preview-headline {
  font-family: var(--font-display);
  font-size: 2rem;
  margin: 0.5em 0;
}

.preview-description {
  font-size: 1.1em;
  line-height: 1.5;
}

.about-preview {
  display: grid;
  gap: 2rem;
  margin-bottom: 2rem;
}

.preview-image img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
  border-radius: var(--radius-lg);
}

.preview-lead {
  font-size: 1.2em;
  color: var(--primary-brown);
  font-weight: 500;
  margin-bottom: 1em;
}

.preview-text {
  color: var(--text-secondary);
  line-height: 1.6;
}

.contact-preview {
  background: var(--neutral-off-white);
  padding: var(--space-4);
  border-radius: var(--radius-lg);
}

.contact-preview h4 {
  color: var(--primary-brown);
  margin-top: 0;
}

.contact-preview p {
  color: var(--text-secondary);
  margin: 0.5em 0;
}
.hidden { display: none !important; }
h1, h2, h3 {
  font-family: var(--font-display);
  color: var(--primary-brown);
}
h1 { font-size: 2rem; margin-bottom: var(--space-4); }
h2 { margin-top: 0; margin-bottom: var(--space-4); }
h3 { font-size: 1.2rem; margin: var(--space-4) 0; }
.admin-page {
  max-width: 1100px;
  margin: 0 auto;
}
.admin-section {
  background: var(--neutral-off-white);
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  box-shadow: 0 2px 12px rgba(0,0,0,0.05);
  margin-bottom: var(--space-6);
}
form > * {
  display: block;
  margin-bottom: var(--space-4);
}
input[type=text], input[type=password], input[type=email], input[type=file], textarea, select {
  width: 100%;
  padding: 0.5em;
  border: 2px solid rgba(58,47,42,0.1);
  border-radius: var(--radius-lg);
  font-family: var(--font-body);
  font-size: 1em;
  box-sizing: border-box;
}
textarea {
  min-height: 120px;
  resize: vertical;
}
button {
  padding: 0.6em 1.2em;
  border: none;
  border-radius: var(--radius-lg);
  background-color: var(--accent-gold);
  color: #fff;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s;
}
button:hover {
  background-color: #9a7209;
}
button.btn-danger {
  background-color: #B33232;
}
button.btn-danger:hover {
  background-color: #8a2626;
}
.flex-row {
  display: flex;
  gap: 1rem;
  align-items: center;
}
.flex-row > * {
  margin: 0;
}
.status-message {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--accent-gold);
  color: white;
  padding: 12px 18px;
  border-radius: var(--radius-lg);
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index: 10001;
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
}
.status-message.visible {
  opacity: 1;
  pointer-events: auto;
}
.item-list {
  max-height: 250px;
  overflow-y: auto;
  margin-top: 1em;
  border: 1px solid #ccc;
  border-radius: var(--radius-lg);
  padding: 0.5em;
  background: #fafafa;
}
label {
  font-weight: 600;
  margin-bottom: 0.3em;
  display: block;
}
</style>
</head>
<body>

<div class="admin-page">
  <!-- Status Notification -->
  <div id="statusMessage" class="status-message"></div>

  <!-- LOGIN SCREEN -->
  <section id="adminLoginScreen">
    <h1>Prihl√°senie do administr√°cie</h1>
    <form id="adminLoginForm">
      <div class="form-group">
        <label for="adminUsername">Pou≈æ√≠vateƒæsk√© meno</label>
        <input type="text" id="adminUsername" required>
      </div>
      <div class="form-group">
        <label for="adminPassword">Heslo</label>
        <input type="password" id="adminPassword" required>
      </div>
      <button type="submit">Prihl√°si≈• sa</button>
    </form>
    <div id="adminLoginError" style="color:red; display:none; margin-top:1em;"></div>
  </section>

  <!-- DASHBOARD -->
  <section id="adminDashboard" class="hidden">
    <h1>Administr√°torsk√Ω panel</h1>
    <div style="display: flex; gap: 1rem; margin-bottom: 15px; flex-wrap: wrap;">
      <button id="logoutBtn">Odhl√°si≈• sa</button>
      <button id="syncToGitHubBtn" style="background-color: #2563eb;">üöÄ Publikova≈• zmeny (GitHub)</button>
      <button id="setupGitHubBtn" style="background-color: #6b7280;">‚öôÔ∏è Nastavenie GitHub</button>
    </div>

    <!-- GitHub Setup Modal (hidden by default) -->
    <div id="githubSetupModal" class="hidden" style="background: white; padding: 2rem; border-radius: 0.5rem; margin-bottom: 1rem; border: 2px solid #2563eb;">
      <h3>Nastavenie GitHub Sync</h3>
      <p style="color: #666; margin-bottom: 1rem;">Pre automatick√© publikovanie zmien potrebujete GitHub Personal Access Token.</p>
      
      <label for="githubToken">GitHub Personal Access Token</label>
      <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" style="margin-bottom: 1rem;">
      <small style="display: block; color: #666; margin-bottom: 1rem;">
        Vytvorte token na: <a href="https://github.com/settings/tokens/new" target="_blank">GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</a><br>
        Potrebn√© opr√°vnenia: <code>repo</code> (Full control of private repositories)
      </small>
      
      <label for="githubRepo">Repository (username/repo-name)</label>
      <input type="text" id="githubRepo" placeholder="napr: username/website-podbanske" style="margin-bottom: 1rem;">
      
      <div style="display: flex; gap: 1rem;">
        <button onclick="saveGitHubConfig()" style="background-color: #16a34a;">üíæ Ulo≈æi≈• nastavenie</button>
        <button onclick="document.getElementById('githubSetupModal').classList.add('hidden')" style="background-color: #6b7280;">Zru≈°i≈•</button>
      </div>
    </div>

    <!-- Hero Section Management -->
    <div class="admin-section">
      <h2>Spr√°va √∫vodnej sekcie</h2>
      <div class="admin-section-layout">
        <div class="edit-panel">
          <form id="heroEditForm">
            <label for="heroEyebrow">Nadpis nad hlavn√Ωm titulkom</label>
            <input type="text" id="heroEyebrow">
            
            <label for="heroMainHeadline">Hlavn√Ω titulok</label>
            <input type="text" id="heroMainHeadline">
            
            <label for="heroSubHeadline">Podtitulok</label>
            <input type="text" id="heroSubHeadline">
            
            <label for="heroDescription">Popis</label>
            <textarea id="heroDescription"></textarea>
            
            <label for="heroBackgroundImageFile">Pozadie (Vybra≈• obr√°zok)</label>
            <input type="file" id="heroBackgroundImageFile" accept="image/*">
            <input type="hidden" id="heroBackgroundImage">
            
            <button type="submit">Ulo≈æi≈• zmeny</button>
          </form>
        </div>
        <div class="preview-panel">
          <h3>N√°hƒæad sekcie</h3>
          <div class="hero-preview" id="heroPreview">
            <div class="preview-content">
              <p class="preview-eyebrow"></p>
              <h2 class="preview-headline"></h2>
              <p class="preview-description"></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- O n√°s Management -->
    <div class="admin-section">
      <h2>Spr√°va sekcie O n√°s</h2>
      <div class="admin-section-layout">
        <div class="edit-panel">
          <form id="aboutEditForm">
            <label for="aboutLeadText">Hlavn√Ω text</label>
            <textarea id="aboutLeadText" required></textarea>
            
            <label for="aboutContent">Obsah</label>
            <textarea id="aboutContent" required></textarea>
            
            <label for="aboutImageFile">Obr√°zok</label>
            <input type="file" id="aboutImageFile" accept="image/*">
            <input type="hidden" id="aboutImage">

            <h3>Kontaktn√© √∫daje</h3>
            <label for="contactAddress">Adresa</label>
            <textarea id="contactAddress"></textarea>

            <label for="contactPhone">Telef√≥n</label>
            <input type="text" id="contactPhone">

            <label for="contactEmail">Email</label>
            <input type="email" id="contactEmail">
            
            <button type="submit">Ulo≈æi≈• zmeny</button>
          </form>
        </div>
        <div class="preview-panel">
          <h3>N√°hƒæad sekcie</h3>
          <div class="about-preview" id="aboutPreview">
            <div class="preview-image">
              <img src="" alt="N√°hƒæad obr√°zku">
            </div>
            <div class="preview-content">
              <div class="preview-lead"></div>
              <div class="preview-text"></div>
            </div>
          </div>
          <div class="contact-preview" id="contactPreview">
            <h4>Kontaktn√© √∫daje</h4>
            <p class="preview-address"></p>
            <p class="preview-phone"></p>
            <p class="preview-email"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Activities Management -->
    <div class="admin-section">
      <h2>Spr√°va aktiv√≠t</h2>
      <form id="addActivityForm">
        <label for="activityTitle">N√°zov aktivity</label>
        <input type="text" id="activityTitle" required>
        
        <label for="activityDescription">Popis</label>
        <textarea id="activityDescription" required></textarea>
        
        <label for="activityCategory">Kateg√≥ria</label>
        <input type="text" id="activityCategory">
        
        <label for="activityImageFile">Obr√°zok</label>
        <input type="file" id="activityImageFile" accept="image/*">
        <input type="hidden" id="activityImage">
        
        <button type="submit">Prida≈•/Upravi≈• aktivitu</button>
      </form>
      <div id="activityList" class="item-list"></div>
    </div>

    <!-- Hist√≥ria Management -->
    <div class="admin-section">
      <h2>Spr√°va hist√≥rie</h2>
      <form id="historyEditForm">
        <label for="historyTitle">Nadpis</label>
        <input type="text" id="historyTitle" required>
        
        <label for="historyContent">Obsah</label>
        <textarea id="historyContent" required></textarea>
        
        <label for="historyImageFile">Obr√°zok</label>
        <input type="file" id="historyImageFile" accept="image/*">
        <input type="hidden" id="historyImage">
        
        <button type="submit">Ulo≈æi≈• zmeny</button>
      </form>
    </div>

    <!-- Pr√≠roda Management -->
    <div class="admin-section">
      <h2>Spr√°va sekcie Pr√≠roda</h2>
      <form id="natureEditForm">
        <label for="natureTitle">Nadpis</label>
        <input type="text" id="natureTitle" required>
        
        <label for="natureContent">Obsah</label>
        <textarea id="natureContent" required></textarea>
        
        <label for="natureImageFile">Obr√°zok</label>
        <input type="file" id="natureImageFile" accept="image/*">
        <input type="hidden" id="natureImage">
        
        <button type="submit">Ulo≈æi≈• zmeny</button>
      </form>
    </div>

    <!-- Pravidl√° Management -->
    <div class="admin-section">
      <h2>Spr√°va pravidiel</h2>
      <form id="rulesEditForm">
        <label for="rulesTitle">Nadpis</label>
        <input type="text" id="rulesTitle" required>
        
        <label for="rulesContent">Obsah pravidiel</label>
        <textarea id="rulesContent" required></textarea>
        
        <button type="submit">Ulo≈æi≈• zmeny</button>
      </form>
    </div>

    <!-- Magick√© Podbansk√© Management -->
    <div class="admin-section">
      <h2>Spr√°va sekcie Magick√© Podbansk√©</h2>
      <form id="magicEditForm">
        <label for="magicTitle">Nadpis</label>
        <input type="text" id="magicTitle" required>
        
        <label for="magicContent">Obsah</label>
        <textarea id="magicContent" required></textarea>
        
        <label for="magicImageFile">Obr√°zok</label>
        <input type="file" id="magicImageFile" accept="image/*">
        <input type="hidden" id="magicImage">
        
        <button type="submit">Ulo≈æi≈• zmeny</button>
      </form>
    </div>

    <!-- Footer Text Management -->
    <div class="admin-section">
      <h2>Spr√°va p√§tiƒçky</h2>
      <form id="footerEditForm">
        <label for="footerText">Text v p√§tiƒçke</label>
        <input type="text" id="footerText">
        <button type="submit">Ulo≈æi≈• text</button>
      </form>
    </div>
  </section>
</div>

<!-- GitHub Sync Module -->
<script src="github-sync.js"></script>

<!-- Firebase initialization & sync (Storage + Firestore) -->
<script type="module" src="firebase-init.js"></script>
<script>
(() => {
  const statusMessageEl = document.getElementById("statusMessage");

  function notify(msg) {
    statusMessageEl.textContent = msg;
    statusMessageEl.classList.add("visible");
    setTimeout(() => statusMessageEl.classList.remove("visible"), 3000);
  }

  // Login Logic
  const adminLoginScreen = document.getElementById("adminLoginScreen");
  const adminDashboard = document.getElementById("adminDashboard");
  const loginForm = document.getElementById("adminLoginForm");
  const loginError = document.getElementById("adminLoginError");
  const logoutBtn = document.getElementById("logoutBtn");

  function showDashboard() {
    adminLoginScreen.classList.add("hidden");
    adminDashboard.classList.remove("hidden");
  }
  function showLogin() {
    adminLoginScreen.classList.remove("hidden");
    adminDashboard.classList.add("hidden");
  }
  function checkLogin() {
    return sessionStorage.getItem("loggedIn") === "true";
  }

  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const username = document.getElementById("adminUsername").value.trim();
    const password = document.getElementById("adminPassword").value.trim();
    if (username === "admin" && password === "podban2024") {
      sessionStorage.setItem("loggedIn", "true");
      showDashboard();
      loadAllDataToForms();
      loginError.style.display = "none";
    } else {
      loginError.textContent = "Nespr√°vne prihlasovacie √∫daje";
      loginError.style.display = "block";
    }
  });

  logoutBtn.addEventListener("click", () => {
    sessionStorage.removeItem("loggedIn");
    showLogin();
    clearForms();
  });

  if (checkLogin()) {
    showDashboard();
  }

  // Data Keys
  const KEYS = {
    NAV: "siteNavigation",
    HERO: "heroSection",
    ABOUT: "aboutSection",
    ACTIVITIES: "adminActivities",
    HISTORY: "historySection",
    NATURE: "natureSection",
    RULES: "rulesSection",
    MAGIC: "magicSection",
    CONTACT: "contactInfo",
    FOOTER: "footerText",
  };

  // Load data or default
  function getData(key, defaultValue) {
    let d = localStorage.getItem(key);
    if (!d) return defaultValue;
    try {
      return JSON.parse(d);
    } catch {
      return defaultValue;
    }
  }
  
  // Save data to localStorage
  function saveData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }

  // Image Upload Helper
  async function handleImageUpload(file, section) {
    if (!file) return null;
    // Try to use firebaseStorage if available, otherwise fallback to data URL
    try {
      if (window.firebaseStorage && typeof window.firebaseStorage.uploadImage === 'function') {
        const path = `images/${section}/${Date.now()}_${file.name}`;
        // If Firebase is available, prefer uploading and returning a public URL
        return await window.firebaseStorage.uploadImage(file, path);
      }
    } catch (err) {
      console.warn('Firebase upload failed:', err);
      // If Firebase exists but failed, do not fallback to data URL (may exceed Firestore limits)
      notify('Nahr√°vanie obr√°zka do cloudu zlyhalo. Sk√∫ste nesk√¥r.');
      return null;
    }

    // Fallback mode (when Firebase not present): convert file to data URL so local previews still work
    try {
      return await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = (e) => reject(e);
        reader.readAsDataURL(file);
      });
    } catch (err) {
      console.error('Failed to read file as DataURL:', err);
      notify('Nahr√°vanie obr√°zka zlyhalo');
      return null;
    }
  }

    // Hero Section Management
  const heroForm = document.getElementById("heroEditForm");
  const heroImageFile = document.getElementById("heroBackgroundImageFile");
  const heroImageHidden = document.getElementById("heroBackgroundImage");

  // Hero preview update function
  async function updateHeroPreview() {
    const eyebrowText = document.getElementById("heroEyebrow").value;
    const headlineText = document.getElementById("heroMainHeadline").value;
    const descriptionText = document.getElementById("heroDescription").value;
    
    const previewPanel = document.querySelector(".hero-preview");
    previewPanel.querySelector(".preview-eyebrow").textContent = eyebrowText;
    previewPanel.querySelector(".preview-headline").textContent = headlineText;
    previewPanel.querySelector(".preview-description").textContent = descriptionText;
    
    // Handle file input preview
    const fileInput = document.getElementById("heroBackgroundImageFile");
    if (fileInput.files && fileInput.files[0]) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewPanel.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('${e.target.result}')`;
        previewPanel.style.backgroundSize = "cover";
        previewPanel.style.backgroundPosition = "center";
      };
      reader.readAsDataURL(fileInput.files[0]);
    } else if (heroImageHidden.value) {
      previewPanel.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('${heroImageHidden.value}')`;
      previewPanel.style.backgroundSize = "cover";
      previewPanel.style.backgroundPosition = "center";
    }
  }

  // Update preview on input changes
  ["heroEyebrow", "heroMainHeadline", "heroSubHeadline", "heroDescription"].forEach(id => {
    document.getElementById(id).addEventListener("input", updateHeroPreview);
  });

  heroImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'hero');
      if (url) {
        heroImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
        updateHeroPreview();
      }
    }
  });

  heroForm.addEventListener("submit", async e => {
    e.preventDefault();
    const heroData = {
      eyebrow: document.getElementById("heroEyebrow").value.trim(),
      mainHeadline: document.getElementById("heroMainHeadline").value.trim(),
      subHeadline: document.getElementById("heroSubHeadline").value.trim(),
      description: document.getElementById("heroDescription").value.trim(),
      backgroundImage: heroImageHidden.value
    };
    saveData(KEYS.HERO, heroData);
    notify("√övodn√° sekcia bola ulo≈æen√°");
  });

  // About Section Management
  const aboutForm = document.getElementById("aboutEditForm");
  const aboutImageFile = document.getElementById("aboutImageFile");
  const aboutImageHidden = document.getElementById("aboutImage");

  // About section preview update function
  function updateAboutPreview() {
    const leadText = document.getElementById("aboutLeadText").value;
    const contentText = document.getElementById("aboutContent").value;
    const address = document.getElementById("contactAddress").value;
    const phone = document.getElementById("contactPhone").value;
    const email = document.getElementById("contactEmail").value;
    
    // Update about preview
    const aboutPreview = document.getElementById("aboutPreview");
    aboutPreview.querySelector(".preview-lead").textContent = leadText;
    aboutPreview.querySelector(".preview-text").textContent = contentText;
    
    // Handle file input preview
    const fileInput = document.getElementById("aboutImageFile");
    const previewImg = aboutPreview.querySelector(".preview-image img");
    
    if (fileInput.files && fileInput.files[0]) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImg.src = e.target.result;
        previewImg.style.display = "block";
      };
      reader.readAsDataURL(fileInput.files[0]);
    } else if (aboutImageHidden.value) {
      previewImg.src = aboutImageHidden.value;
      previewImg.style.display = "block";
    } else {
      previewImg.style.display = "none";
    }
    
    // Update contact preview
    const contactPreview = document.getElementById("contactPreview");
    contactPreview.querySelector(".preview-address").innerHTML = address.replace(/\n/g, "<br>");
    contactPreview.querySelector(".preview-phone").textContent = phone;
    contactPreview.querySelector(".preview-email").textContent = email;
  }

  // Update preview on input changes
  ["aboutLeadText", "aboutContent", "contactAddress", "contactPhone", "contactEmail"].forEach(id => {
    document.getElementById(id).addEventListener("input", updateAboutPreview);
  });

  aboutImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'about');
      if (url) {
        aboutImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
        updateAboutPreview();
      }
    }
  });

  aboutForm.addEventListener("submit", e => {
    e.preventDefault();
    const aboutData = {
      lead: document.getElementById("aboutLeadText").value.trim(),
      content: document.getElementById("aboutContent").value.trim(),
      image: document.getElementById("aboutImage").value
    };
    saveData(KEYS.ABOUT, aboutData);

    const contactData = {
      address: document.getElementById("contactAddress").value.trim(),
      phone: document.getElementById("contactPhone").value.trim(),
      email: document.getElementById("contactEmail").value.trim()
    };
    saveData(KEYS.CONTACT, contactData);
    
    notify("Sekcia O n√°s bola ulo≈æen√°");
  });

  // Activities Management
  const addActivityForm = document.getElementById("addActivityForm");
  const activityList = document.getElementById("activityList");
  const activityImageFile = document.getElementById("activityImageFile");
  const activityImageHidden = document.getElementById("activityImage");
  let activities = getData(KEYS.ACTIVITIES, []);

  activityImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'activities');
      if (url) {
        activityImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
      }
    }
  });
  let editActivityIndex = -1;

  function renderActivities() {
    activities = getData(KEYS.ACTIVITIES, []);
    if (!activities.length) {
      activityList.innerHTML = '<p style="text-align:center;color:#666;">Zatiaƒæ neboli pridan√© ≈æiadne aktivity</p>';
      return;
    }
    activityList.innerHTML = activities.map((a,i) => `
      <div class="item-row">
        <span>${a.title}</span>
        <div>
          <button type="button" class="edit-activity" data-idx="${i}">Upravi≈•</button>
          <button type="button" class="delete-activity btn-danger" data-idx="${i}">Zmaza≈•</button>
        </div>
      </div>
    `).join("");
    attachActivityButtons();
  }

  function attachActivityButtons() {
    activityList.querySelectorAll(".edit-activity").forEach(btn => {
      btn.onclick = (e) => {
        const idx = e.target.dataset.idx;
        const activity = activities[idx];
        document.getElementById("activityTitle").value = activity.title || "";
        document.getElementById("activityDescription").value = activity.description || "";
        document.getElementById("activityCategory").value = activity.category || "";
        document.getElementById("activityImage").value = activity.image || "";
        document.getElementById("activityImageFile").value = "";
        editActivityIndex = parseInt(idx);
      };
    });
    activityList.querySelectorAll(".delete-activity").forEach(btn => {
      btn.onclick = (e) => {
        const idx = e.target.dataset.idx;
        activities.splice(idx, 1);
        saveData(KEYS.ACTIVITIES, activities);
        renderActivities();
        notify("Aktivita bola zmazan√°");
      };
    });
  }

  addActivityForm.addEventListener("submit", e => {
    e.preventDefault();
    const activity = {
      title: document.getElementById("activityTitle").value.trim(),
      description: document.getElementById("activityDescription").value.trim(),
      category: document.getElementById("activityCategory").value.trim(),
      image: document.getElementById("activityImage").value
    };
    
    if (editActivityIndex >= 0) {
      activities[editActivityIndex] = activity;
      notify("Aktivita bola upraven√°");
      editActivityIndex = -1;
    } else {
      activities.push(activity);
      notify("Aktivita bola pridan√°");
    }
    
    saveData(KEYS.ACTIVITIES, activities);
    addActivityForm.reset();
    renderActivities();
  });

  // Hist√≥ria Management
  const historyForm = document.getElementById("historyEditForm");
  const historyImageFile = document.getElementById("historyImageFile");
  const historyImageHidden = document.getElementById("historyImage");

  historyImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'history');
      if (url) {
        historyImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
      }
    }
  });

  historyForm.addEventListener("submit", e => {
    e.preventDefault();
    const historyData = {
      title: document.getElementById("historyTitle").value.trim(),
      content: document.getElementById("historyContent").value.trim(),
      image: document.getElementById("historyImage").value
    };
    saveData(KEYS.HISTORY, historyData);
    notify("Hist√≥ria bola ulo≈æen√°");
  });

  // Pr√≠roda Management
  const natureForm = document.getElementById("natureEditForm");
  const natureImageFile = document.getElementById("natureImageFile");
  const natureImageHidden = document.getElementById("natureImage");

  natureImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'nature');
      if (url) {
        natureImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
      }
    }
  });

  natureForm.addEventListener("submit", e => {
    e.preventDefault();
    const natureData = {
      title: document.getElementById("natureTitle").value.trim(),
      content: document.getElementById("natureContent").value.trim(),
      image: document.getElementById("natureImage").value
    };
    saveData(KEYS.NATURE, natureData);
    notify("Sekcia Pr√≠roda bola ulo≈æen√°");
  });

  // Pravidl√° Management
  const rulesForm = document.getElementById("rulesEditForm");
  rulesForm.addEventListener("submit", e => {
    e.preventDefault();
    const rulesData = {
      title: document.getElementById("rulesTitle").value.trim(),
      content: document.getElementById("rulesContent").value.trim()
    };
    saveData(KEYS.RULES, rulesData);
    notify("Pravidl√° boli ulo≈æen√©");
  });

  // Magick√© Podbansk√© Management
  const magicForm = document.getElementById("magicEditForm");
  const magicImageFile = document.getElementById("magicImageFile");
  const magicImageHidden = document.getElementById("magicImage");

  magicImageFile.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (file) {
      notify("Nahr√°vam obr√°zok...");
      const url = await handleImageUpload(file, 'magic');
      if (url) {
        magicImageHidden.value = url;
        notify("Obr√°zok bol nahran√Ω");
      }
    }
  });

  magicForm.addEventListener("submit", e => {
    e.preventDefault();
    const magicData = {
      title: document.getElementById("magicTitle").value.trim(),
      content: document.getElementById("magicContent").value.trim(),
      image: document.getElementById("magicImage").value
    };
    saveData(KEYS.MAGIC, magicData);
    notify("Sekcia Magick√© Podbansk√© bola ulo≈æen√°");
  });

  // Footer Management
  const footerForm = document.getElementById("footerEditForm");
  footerForm.addEventListener("submit", e => {
    e.preventDefault();
    const text = document.getElementById("footerText").value.trim();
    localStorage.setItem(KEYS.FOOTER, text);
    notify("Text p√§tiƒçky bol ulo≈æen√Ω");
  });

  // Load all data to forms
  // Initialize preview panels
  function initializePreviews() {
    updateHeroPreview();
    updateAboutPreview();
  }

  function loadAllDataToForms() {
    const heroData = getData(KEYS.HERO, {});
    const aboutData = getData(KEYS.ABOUT, {});
    const contactData = getData(KEYS.CONTACT, {});
    const historyData = getData(KEYS.HISTORY, {});
    const natureData = getData(KEYS.NATURE, {});
    const rulesData = getData(KEYS.RULES, {});
    const magicData = getData(KEYS.MAGIC, {});
    const footerText = localStorage.getItem(KEYS.FOOTER);

    // Fill hero form
    document.getElementById("heroEyebrow").value = heroData.eyebrow || "";
    document.getElementById("heroMainHeadline").value = heroData.mainHeadline || "";
    document.getElementById("heroSubHeadline").value = heroData.subHeadline || "";
    document.getElementById("heroDescription").value = heroData.description || "";
    document.getElementById("heroBackgroundImage").value = heroData.backgroundImage || "";

    // Fill about form (with contact)
    document.getElementById("aboutLeadText").value = aboutData.lead || "";
    document.getElementById("aboutContent").value = aboutData.content || "";
    document.getElementById("aboutImage").value = aboutData.image || "";
    document.getElementById("contactAddress").value = contactData.address || "";
    document.getElementById("contactPhone").value = contactData.phone || "";
    document.getElementById("contactEmail").value = contactData.email || "";

    // Fill history form
    document.getElementById("historyTitle").value = historyData.title || "";
    document.getElementById("historyContent").value = historyData.content || "";
    document.getElementById("historyImage").value = historyData.image || "";

    // Fill nature form
    document.getElementById("natureTitle").value = natureData.title || "";
    document.getElementById("natureContent").value = natureData.content || "";
    document.getElementById("natureImage").value = natureData.image || "";

    // Fill rules form
    document.getElementById("rulesTitle").value = rulesData.title || "";
    document.getElementById("rulesContent").value = rulesData.content || "";

    // Fill magic form
    document.getElementById("magicTitle").value = magicData.title || "";
    document.getElementById("magicContent").value = magicData.content || "";
    document.getElementById("magicImage").value = magicData.image || "";

    // Fill footer form
    document.getElementById("footerText").value = footerText || "";

    // Render lists
    renderActivities();
  }

  // Clear all forms
  function clearForms() {
    document.querySelectorAll("form").forEach(form => form.reset());
    document.querySelectorAll('input[type="hidden"]').forEach(input => input.value = "");
    activityList.innerHTML = "";
  }

  // Initial load if logged in
  if (checkLogin()) {
    loadAllDataToForms();
    initializePreviews();
  }

  // ========== GITHUB SYNC FUNCTIONALITY ==========
  
  // Setup GitHub button
  document.getElementById("setupGitHubBtn").addEventListener("click", () => {
    const modal = document.getElementById("githubSetupModal");
    modal.classList.toggle("hidden");
    
    // Load existing config
    const token = localStorage.getItem('github-token');
    const repo = localStorage.getItem('github-repo');
    if (token) document.getElementById("githubToken").value = token;
    if (repo) document.getElementById("githubRepo").value = repo;
  });

  // Save GitHub config
  window.saveGitHubConfig = function() {
    const token = document.getElementById("githubToken").value.trim();
    const repo = document.getElementById("githubRepo").value.trim();
    
    if (!token || !repo) {
      alert("Vypl≈àte v≈°etky polia!");
      return;
    }
    
    if (!repo.includes('/')) {
      alert("Repository mus√≠ by≈• vo form√°te: username/repo-name");
      return;
    }
    
    window.githubSync.setup(token, repo);
    document.getElementById("githubSetupModal").classList.add("hidden");
    notify("‚úÖ GitHub nastavenie ulo≈æen√©!");
  };

  // Sync to GitHub button
  document.getElementById("syncToGitHubBtn").addEventListener("click", async () => {
    if (!window.githubSync.isConfigured()) {
      alert("Najprv nastavte GitHub sync! Kliknite na '‚öôÔ∏è Nastavenie GitHub'");
      document.getElementById("githubSetupModal").classList.remove("hidden");
      return;
    }
    
    const confirmed = confirm("Publikova≈• v≈°etky zmeny na GitHub?\n\nToto nahr√° obsah na GitHub a Vercel automaticky nasad√≠ zmeny.");
    if (!confirmed) return;
    
    try {
      await window.githubSync.syncToGitHub(notify);
    } catch (error) {
      notify("‚ùå Chyba: " + error.message);
      console.error(error);
    }
  });

})();
</script>

</body>
</html>
